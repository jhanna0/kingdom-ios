service: kingdom-api

provider:
  name: aws
  runtime: python3.11
  region: us-east-1
  profile: dev
  memorySize: 1024
  timeout: 60
  stackName: kingdom-api-stack
  environment:
    RDS_SECRET_NAME: rds!db-5465f705-3666-44af-b197-39944abad239
    RDS_ENDPOINT: kingdom-test-1.cnodr6ou015k.us-east-1.rds.amazonaws.com
    RDS_PORT: '5432'
    RDS_DATABASE: postgres
    JWT_SECRET_KEY: temp-secret-change-me
    DEV_MODE: 'True'
  vpc:
    securityGroupIds:
      - sg-62aae569  # Existing default security group (allows RDS access)
    subnetIds:
      - subnet-7547d013  # us-east-1a - routes through nat-02df60abdc19b6daa
      - subnet-98cd50b9  # us-east-1b - routes through existing NAT
  iam:
    role:
      statements:
        - Effect: Allow
          Action:
            - ec2:CreateNetworkInterface
            - ec2:DescribeNetworkInterfaces
            - ec2:DeleteNetworkInterface
            - ec2:AssignPrivateIpAddresses
            - ec2:UnassignPrivateIpAddresses
          Resource: '*'
        - Effect: Allow
          Action:
            - secretsmanager:GetSecretValue
          Resource: 'arn:aws:secretsmanager:us-east-1:*:secret:rds!db-5465f705-3666-44af-b197-39944abad239-*'

functions:
  api:
    handler: main.handler
    events:
      - httpApi: '*'

custom:
  pythonRequirements:
    dockerizePip: true
    slim: true

package:
  patterns:
    - '!node_modules/**'
    - '!.git/**'
    - '!__pycache__/**'
    - '!*.pyc'

